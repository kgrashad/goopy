from search_service import SearchService, Query, QueryResult
import json
import httplib
import urllib

# !!! FIX: this should be configurable
API_KEY = "AIzaSyDxTFivVL_Ly5QTRPK8FeNk9sxN8S35tT0"
SEARCH_ENGINE_ID = "017576662512468239146:omuauf_lfve"

GOOGLE_HOST = "www.googleapis.com"
GOOGLE_URL = "/customsearch/v1?key=%s&cx=%s&%s"

class GoogleService(SearchService):

    def search(self, query):
        url = GOOGLE_URL % (API_KEY, SEARCH_ENGINE_ID, urllib.urlencode({'q': query.text}))
        status, respone = self._mock_get_request(url)

        if status != 200:
            return QueryResult('Error')
        else:
            return QueryResult('result')


    def _do_get_request(self, url):
        connection = httplib.HTTPSConnection(GOOGLE_HOST)
        connection.request("GET", url)
        response = connection.getresponse()
        return response.status, response.read()

    def _mock_get_request(self, url):
        data = open('google_response.txt', 'r').read()
        return 200, data
